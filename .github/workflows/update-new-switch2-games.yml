name: Update New Switch 2 Games

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *" # alle 6 Stunden

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ğŸ“¦ Install Dependencies
        run: npm install   # <-- FIX: kein `ci` mehr

      - name: â–¶ï¸ Run fetch script
        id: fetch
        run: |
          echo "ğŸš€ Starte Scraper..."
          set -e
          node scripts/fetch-switch2.js || echo "SCRAPER_FAILED=true" >> $GITHUB_ENV

      - name: ğŸ’¾ Commit and Push changes
        if: env.SCRAPER_FAILED != 'true'
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add new_switch2_games.json
          git commit -m "Update Switch 2 games JSON"
          git push

      - name: ğŸ“¸ Upload Debug Screenshot
        if: env.SCRAPER_FAILED == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: scraper_debug
          path: scraper_debug.png