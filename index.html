<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Switch 2 – Performance Patches & Neue Spiele</title>
  <meta name="color-scheme" content="dark light">
  <style>
    :root { --bg:#0b0e11; --card:#12161c; --text:#e6edf3; --muted:#9aa7b2; --accent:#26c281; --table:#1f2630; }
    html,body{ background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; margin:0; }
    header{ padding:24px 20px 10px; }
    h1{ font-size:1.6rem; margin:0; display:flex; gap:.5rem; align-items:baseline; flex-wrap:wrap; }
    .date{ color:var(--muted); font-size:.95rem; font-weight:500; }
    .tabs{ display:flex; gap:8px; padding:0 20px 12px; flex-wrap:wrap; }
    .tab-btn{ background:var(--card); border:1px solid var(--table); color:var(--text); padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:600; }
    .tab-btn[aria-selected="true"]{ outline:2px solid var(--accent); }
    .wrap{ padding:0 20px 28px; }
    .table-card{ background:var(--card); border:1px solid var(--table); border-radius:14px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    table{ width:100%; border-collapse:collapse; }
    thead th{ text-align:left; padding:14px 12px; font-size:.92rem; color:var(--muted); border-bottom:1px solid var(--table); font-weight:600; }
    tbody td{ padding:10px 12px; border-bottom:1px solid var(--table); vertical-align:middle; }
    tbody tr:hover{ background:rgba(255,255,255,.02); }
    .thumb{ width:270px; height:153px; border-radius:8px; object-fit:cover; display:block; border:1px solid #222b36; }
    .game a{ color:var(--text); text-decoration:none; font-weight:600; }
    .game a:hover{ text-decoration:underline; }
    .kernCell{ color:var(--text); }
    .source a{ color:var(--muted); text-decoration:none; }
    .source a:hover{ text-decoration:underline; }
    .hidden{ display:none; }
    .foot{ color:var(--muted); font-size:.9rem; margin-top:14px; line-height:1.5; }
    .note{ color:var(--muted); font-size:.9rem; }
  </style>
</head>
<body>
  <header>
    <h1>Performance&nbsp;Patches: <span id="count1">0</span> <span class="date">• Stand: <time id="today">20.08.2025</time></span></h1>
  </header>

  <nav class="tabs" role="tablist" aria-label="Listenwahl">
    <button class="tab-btn" role="tab" id="tab-perf" aria-selected="true" aria-controls="panel-perf">Performance-Patches</button>
    <button class="tab-btn" role="tab" id="tab-new" aria-selected="false" aria-controls="panel-new">Neue Switch 2 Spiele</button>
  </nav>

  <div class="wrap">
    <!-- Panel 1: Performance Patches -->
    <section id="panel-perf" class="table-card" role="tabpanel" aria-labelledby="tab-perf">
      <table id="games1">
        <thead>
          <tr><th>Thumbnail</th><th>Spiel (Nintendo DE bevorzugt)</th><th>Kern‑Patch‑Inhalte</th><th>Quelle</th></tr>
        </thead>
        <tbody>
          <!-- rows injected by script -->
        </tbody>
      </table>
    </section>

    <!-- Panel 2: Neue Switch 2 Spiele -->
    <section id="panel-new" class="table-card hidden" role="tabpanel" aria-labelledby="tab-new">
      <div class="note" id="newNote">Die Liste lädt automatisch beim Seitenaufruf (lokaler Datenstand; Online‑Abgleich wird versucht).</div>
      <table id="games2">
        <thead>
          <tr><th>Thumbnail</th><th>Spiel (Nintendo DE bevorzugt)</th><th>Kern‑Patch‑Inhalte</th><th>Quelle</th></tr>
        </thead>
        <tbody>
          <!-- auto-loaded -->
        </tbody>
      </table>
      <p class="note" id="newCount"></p>
    </section>

    <p class="foot">
      Regeln: Links & Thumbnails vorrangig vom deutschen Nintendo‑Shop. Liefert ein DE‑Link 404 (<code>/de-de/404.html</code>), wird automatisch auf die US‑Shop‑Seite umgeschaltet und deren Hero‑Bild als Thumbnail genutzt. Thumbnails sind Pflicht; wenn auch das fehlschlägt, wird ein Inline‑SVG generiert.
    </p>
  </div>

  <script>
    // Datum
    try { document.getElementById('today').textContent = new Intl.DateTimeFormat('de-DE').format(new Date()); } catch(e){}

    // Tabs
    const tabPerf = document.getElementById('tab-perf');
    const tabNew  = document.getElementById('tab-new');
    const panelPerf = document.getElementById('panel-perf');
    const panelNew  = document.getElementById('panel-new');
    function select(tab) {
      const isPerf = tab.id === 'tab-perf';
      tabPerf.setAttribute('aria-selected', isPerf);
      tabNew.setAttribute('aria-selected', !isPerf);
      panelPerf.classList.toggle('hidden', !isPerf);
      panelNew.classList.toggle('hidden', isPerf);
    }
    tabPerf.addEventListener('click', () => select(tabPerf));
    tabNew.addEventListener('click',  () => select(tabNew));

    // Robust thumbnail: verify decode, else fallback to alt1, else inline SVG
    function ensureThumb(img, title) {
      function setSvgFallback(reason) {
        const svg = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='270' height='153'>
          <defs><linearGradient id='g' x1='0' x2='1' y1='0' y2='1'><stop offset='0' stop-color='#1b2a33'/><stop offset='1' stop-color='#0f1720'/></linearGradient></defs>
          <rect width='100%' height='100%' fill='url(#g)'/>
          <text x='16' y='84' font-family='system-ui,Segoe UI,Arial' font-size='20' fill='#e6edf3'>${(title||'Spiel').replace(/&/g,'&amp;')}</text>
          <text x='16' y='120' font-family='system-ui,Segoe UI,Arial' font-size='12' fill='#9aa7b2'>${reason}</text>
        </svg>`);
        img.src = `data:image/svg+xml;charset=utf-8,${svg}`;
      }
      (img.decode ? img.decode() : Promise.resolve()).then(() => {
        if (!img.naturalWidth || !img.naturalHeight) throw new Error('empty');
      }).catch(() => {
        const alt1 = img.getAttribute('data-alt1');
        if (alt1 && img.src !== alt1) {
          img.src = alt1;
          (img.decode ? img.decode() : Promise.resolve()).then(()=>{
            if (!img.naturalWidth) setSvgFallback('Bild-Fallback aktiv');
          }).catch(()=> setSvgFallback('Bild-Fallback fehlgeschlagen'));
        } else {
          setSvgFallback('Kein Bild verfügbar');
        }
      });
      img.onerror = () => {
        const alt1 = img.getAttribute('data-alt1');
        if (alt1 && img.src !== alt1) { img.src = alt1; } else { setSvgFallback('Ladefehler'); }
      };
    }

    // Render helpers
    const perfData = [{"name": "ARMS", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/ARMS-1173200.html", "us": "https://www.nintendo.com/us/store/products/arms-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/a/arms-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_Arms_image1600w.jpg", "kern": "Visuelle Optimierung, stabilere Framerate, HDR (TV)"}, {"name": "Captain Toad: Treasure Tracker", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/Captain-Toad-Treasure-Tracker-1348071.html", "us": "https://www.nintendo.com/us/store/products/captain-toad-treasure-tracker-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/c/captain-toad-treasure-tracker-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_CaptainToadTreasureTracker_image1600w.png", "kern": "Visuelle Optimierung, HDR (TV)"}, {"name": "Spielestudio (Game Builder Garage)", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Download-Software/Spielestudio-1964648.html", "us": "https://www.nintendo.com/us/store/products/game-builder-garage-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/g/game-builder-garage-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_download_software_1/H2x1_NSwitchDS_GameBuilderGarage_deDE_image1600w.jpg", "kern": "Visuelle Optimierung (höhere Bildqualität)"}, {"name": "New Super Mario Bros. U Deluxe", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/New-Super-Mario-Bros-U-Deluxe-1438640.html", "us": "https://www.nintendo.com/us/store/products/new-super-mario-bros-u-deluxe-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/n/new-super-mario-bros-u-deluxe-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_NewSuperMarioBrosUDeluxe_image1600w.jpg", "kern": "Visuelle Optimierung (höhere Bildqualität)"}, {"name": "Pokémon Karmesin", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/Pokemon-Karmesin-2179556.html", "us": "https://www.nintendo.com/us/store/products/pokemon-scarlet-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/p/pokemon-scarlet-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/2x1_NSwitch_PokemonScarletViolet_Scarlet_deDE_image1600w.jpg", "kern": "Visuelle Optimierung, höhere FPS"}, {"name": "Pokémon Purpur", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/Pokemon-Purpur-2179557.html", "us": "https://www.nintendo.com/us/store/products/pokemon-violet-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/p/pokemon-violet-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/2x1_NSwitch_PokemonScarletViolet_Violet_deDE_image1600w.jpg", "kern": "Visuelle Optimierung, höhere FPS"}, {"name": "Splatoon 3", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/Splatoon-3-2008811.html", "us": "https://www.nintendo.com/us/store/products/splatoon-3-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/s/splatoon-3-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_Splatoon3_image1600w.jpg", "kern": "Visuelle Optimierung, flüssigeres Bewegen im Hub"}, {"name": "Super Mario 3D World + Bowser’s Fury", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/Super-Mario-3D-World-Bowser-s-Fury-1832228.html", "us": "https://www.nintendo.com/us/store/products/super-mario-3d-world-bowsers-fury-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/s/super-mario-3d-world-bowsers-fury-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_SuperMario3DWorldBowsersFury_image1600w.jpg", "kern": "Visuelle Optimierung, bessere FPS; HDR (nur Bowser’s Fury)"}, {"name": "Super Mario Odyssey", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/Super-Mario-Odyssey-1173332.html", "us": "https://www.nintendo.com/us/store/products/super-mario-odyssey-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/s/super-mario-odyssey-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_SuperMarioOdyssey_image1600w.jpg", "kern": "Visuelle Optimierung, HDR (TV)"}, {"name": "The Legend of Zelda: Echoes of Wisdom", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/The-Legend-of-Zelda-Echoes-of-Wisdom-2590490.html", "us": "https://www.nintendo.com/us/store/products/the-legend-of-zelda-echoes-of-wisdom-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/t/the-legend-of-zelda-echoes-of-wisdom-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/2x1_NSwitch_TheLegendofZeldaEchoesOfWisdom_image1600w.jpg", "kern": "Visuelle Optimierung, HDR (TV)"}, {"name": "The Legend of Zelda: Link’s Awakening", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/The-Legend-of-Zelda-Link-s-Awakening-1514327.html", "us": "https://www.nintendo.com/us/store/products/the-legend-of-zelda-links-awakening-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/t/the-legend-of-zelda-links-awakening-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_TheLegendOfZeldaLinksAwakening_image1600w.jpg", "kern": "Visuelle Optimierung, HDR (TV)"}, {"name": "Fortnite", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/Fortnite-1510812.html", "us": "https://www.nintendo.com/us/store/products/fortnite-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/f/fortnite-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_Fortnite_image1600w.jpg", "kern": "60 FPS, höhere Auflösung, zusätzliche Systeme‑Features"}, {"name": "Apex Legends", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/Apex-Legends--1910595.html", "us": "https://www.nintendo.com/us/store/products/apex-legends-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/a/apex-legends-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_ApexLegends_image1600w.jpg", "kern": "Bis 60 FPS; 1080p (Dock) / 1792×1008 (Handheld)"}, {"name": "No Man’s Sky", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/No-Man-s-Sky-2197037.html", "us": "https://www.nintendo.com/us/store/products/no-mans-sky-switch/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/n/no-mans-sky-switch/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_NoMansSky_image1600w.jpg", "kern": "Enhanced Visuals, Multiplayer u. Features (Switch‑2‑Upgrade‑Pack)"}, {"name": "The Legend of Zelda: Breath of the Wild – Nintendo Switch 2 Edition", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-2-Edition/The-Legend-of-Zelda-Breath-of-the-Wild-Nintendo-Switch-2-Edition-2787250.html", "us": "https://www.nintendo.com/us/store/products/the-legend-of-zelda-breath-of-the-wild-nintendo-switch-2-edition-upgrade-pack-switch-2/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/t/the-legend-of-zelda-breath-of-the-wild-nintendo-switch-2-edition-upgrade-pack-switch-2/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/12_switch_2_share_images/1x1_NSwitch2_TLoZBotWNS2Ed_Share.jpg", "kern": "Upgrade Pack (9,99 €): 60 FPS, höhere Auflösung, HDR, schnellere Ladezeiten; inkl. „Zelda Notes“ (NSO+EP gratis)."}, {"name": "The Legend of Zelda: Tears of the Kingdom – Nintendo Switch 2 Edition", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-2-Edition/The-Legend-of-Zelda-Tears-of-the-Kingdom-Nintendo-Switch-2-Edition-2787249.html", "us": "https://www.nintendo.com/us/store/products/the-legend-of-zelda-tears-of-the-kingdom-nintendo-switch-2-edition-upgrade-pack-switch-2/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/t/the-legend-of-zelda-tears-of-the-kingdom-nintendo-switch-2-edition-upgrade-pack-switch-2/hero", "img_fallback": "https://www.nintendo.com/eu/media/images/12_switch_2_share_images/1x1_NSwitch2_TLoZTotKNS2Ed_Share.jpg", "kern": "Upgrade Pack (9,99 €): 60 FPS, höhere Auflösung, HDR, schnellere Ladezeiten; inkl. „Zelda Notes“ (NSO+EP gratis)."}, {"name": "Kirby und das vergessene Land – Nintendo Switch 2 Edition + Sternensplitter‑Welt", "de": "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-2-Edition/Kirby-und-das-vergessene-Land-Nintendo-Switch-2-Edition-Die-Sternensplitter-Welt-2787773.html", "us": "https://www.nintendo.com/us/store/products/kirby-and-the-forgotten-land-nintendo-switch-2-edition-plus-star-crossed-world-upgrade-pack-switch-2/", "img_primary": "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/k/kirby-and-the-forgotten-land-nintendo-switch-2-edition-plus-star-crossed-world-upgrade-pack-switch-2/hero", "img_fallback": "https://www.nintendo.com/en-gb/content/dam/noa/en_GB/games/switch2/kirby-and-the-forgotten-land-nintendo-switch-2-edition-star-crossed-world/1x1_NSwitch2_KirbyForgottenLandNS2EdSCW_S2Bar_EN_gb.jpg", "kern": "Upgrade Pack (19,99 €): bessere Grafik/FPS + neue Story „Sternensplitter‑Welt“."}];
    function rowHtml(entry) {
      const link = entry.de || entry.us || '#';
      const label = entry.de ? 'Nintendo DE' : (entry.us ? 'Nintendo US' : 'Nintendo');
      const imgP = entry.img_primary || '';
      const imgF = entry.img_fallback || '';
      const kern = entry.kern || '—';
      const title = entry.name || 'Unbekannt';
      return `<tr>
        <td><a href="${link}" target="_blank" rel="noopener">
          <img class="thumb" src="${imgP}" data-alt1="${imgF}" alt="Thumbnail ${title}">
        </a></td>
        <td class="game"><a href="${link}" target="_blank" rel="noopener">${title}</a></td>
        <td class="kernCell">${kern}</td>
        <td class="source"><a href="${link}" target="_blank" rel="noopener">${label}</a></td>
      </tr>`;
    }

    // Inject perf rows
    const tbody1 = document.querySelector('#games1 tbody');
    tbody1.innerHTML = perfData.map(rowHtml).join('\n');
    // Verify images
    tbody1.querySelectorAll('img.thumb').forEach(img => ensureThumb(img, img.alt.replace('Thumbnail ','') ));

    // Counter
    document.getElementById('count1').textContent = document.querySelectorAll('#games1 tbody tr').length;

    // ---- Neue Switch‑2‑Spiele: auto load without button ----
    const newBody = document.querySelector('#games2 tbody');
    const newNote = document.getElementById('newNote');
    const newCount = document.getElementById('newCount');

    async function loadLocalSeed() {
      const r = await fetch('./new_games_seed.json');
      const data = await r.json();
      return data;
    }

    function renderNew(list) {
      newBody.innerHTML = list.map(e => rowHtml(e)).join('\n');
      newBody.querySelectorAll('img.thumb').forEach(img => ensureThumb(img, img.alt.replace('Thumbnail ','') ));
      newCount.textContent = 'Anzahl (lokaler Stand): ' + list.length;
    }

    // Try online sync (best effort). If it fails, we keep local seed.
    async function tryOnlineSync(list) {
      try {
        const usUrl = 'https://www.nintendo.com/us/store/games/nintendo-switch-2-games/';
        const html = await fetch(usUrl, {mode: 'cors'}).then(r => r.text());
        // Heuristic: find product slugs and titles
        const re = /"title":"([^"]+?)","url":"(\/us\/store\/products\/[^"]+?)"/g;
        let m; const out = []; const seen = new Set();
        while ((m = re.exec(html)) && out.length < 200) {
          const title = m[1]; const path = m[2];
          const url = 'https://www.nintendo.com' + path;
          const slug = path.split('/').filter(Boolean).pop();
          const hero = `https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/${slug[0]}/${slug}/hero`;
          if (seen.has(url)) continue; seen.add(url);
          out.push({ name: title, us: url, img_primary: hero });
        }
        if (out.length > 0) {
          renderNew(out);
          newNote.textContent = 'Automatisch synchronisiert (Nintendo‑US Listing).';
          newCount.textContent = 'Anzahl (online): ' + out.length;
          return;
        }
        // Else keep seed
      } catch(e) {
        // Ignore; keep seed
      }
      renderNew(list);
      newNote.textContent = 'Automatisch aus lokalem Datenstand geladen (Online‑Sync nicht verfügbar).';
    }

    // Auto‑start on load — no button
    (async () => {
      const seed = await loadLocalSeed();
      await tryOnlineSync(seed);
    })();
  </script>
</body>
</html>
