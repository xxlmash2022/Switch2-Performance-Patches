<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Switch 2 – Performance Patches & Neue Spiele</title>
  <meta name="color-scheme" content="dark light">
  <style>
    :root { --bg:#0b0e11; --card:#12161c; --text:#e6edf3; --muted:#9aa7b2; --accent:#26c281; --table:#1f2630; }
    html,body{ background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; margin:0; }
    header{ padding:24px 20px 10px; }
    h1{ font-size:1.6rem; margin:0; display:flex; gap:.5rem; align-items:baseline; flex-wrap:wrap; }
    .date{ color:var(--muted); font-size:.95rem; font-weight:500; }
    .tabs{ display:flex; gap:8px; padding:0 20px 12px; flex-wrap:wrap; }
    .tab-btn{ background:var(--card); border:1px solid var(--table); color:var(--text); padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:600; }
    .tab-btn[aria-selected="true"]{ outline:2px solid var(--accent); }
    .wrap{ padding:0 20px 28px; }
    .table-card{ background:var(--card); border:1px solid var(--table); border-radius:14px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    table{ width:100%; border-collapse:collapse; }
    thead th{ text-align:left; padding:14px 12px; font-size:.92rem; color:var(--muted); border-bottom:1px solid var(--table); font-weight:600; }
    tbody td{ padding:10px 12px; border-bottom:1px solid var(--table); vertical-align:middle; }
    tbody tr:hover{ background:rgba(255,255,255,.02); }
    .thumb{ width:270px; height:153px; border-radius:8px; object-fit:cover; display:block; border:1px solid #222b36; }
    .game a{ color:var(--text); text-decoration:none; font-weight:600; }
    .game a:hover{ text-decoration:underline; }
    .kernCell{ color:var(--text); }
    .source a{ color:var(--muted); text-decoration:none; }
    .source a:hover{ text-decoration:underline; }
    .hidden{ display:none; }
    .foot{ color:var(--muted); font-size:.9rem; margin-top:14px; line-height:1.5; }
  </style>
</head>
<body>
  <header>
    <h1>Performance&nbsp;Patches: <span id="count1">0</span> <span class="date">• Stand: <time id="today"></time></span></h1>
  </header>

  <nav class="tabs" role="tablist" aria-label="Listenwahl">
    <button class="tab-btn" role="tab" id="tab-perf" aria-selected="true" aria-controls="panel-perf">Performance-Patches</button>
    <button class="tab-btn" role="tab" id="tab-new" aria-selected="false" aria-controls="panel-new">Neue Switch 2 Spiele</button>
  </nav>

  <div class="wrap">
    <!-- Panel 1 -->
    <section id="panel-perf" class="table-card" role="tabpanel" aria-labelledby="tab-perf">
      <table id="games1">
        <thead><tr><th>Thumbnail</th><th>Spiel (Nintendo DE bevorzugt)</th><th>Kern-Patch-Inhalte</th><th>Quelle</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Panel 2 -->
    <section id="panel-new" class="table-card hidden" role="tabpanel" aria-labelledby="tab-new">
      <div class="foot">Die Liste wird beim Laden automatisch aus <code>new_switch2_games.json</code> eingelesen (DE bevorzugt, US-Fallback in den Daten). Pflege/Abgleich erfolgt serverseitig per GitHub Action.</div>
      <table id="games2">
        <thead><tr><th>Thumbnail</th><th>Spiel (Nintendo DE bevorzugt)</th><th>Kern-Patch-Inhalte</th><th>Quelle</th></tr></thead>
        <tbody></tbody>
      </table>
      <p class="foot" id="newCount"></p>
    </section>

    <p class="foot">
      Regeln: DE-Shoplinks bevorzugt; wenn ein DE-Link 404 liefert, verwenden wir automatisch die US-Seite. Thumbnails: **EU-H2x1 → US-Hero → Inline-SVG** (immer sichtbar).
    </p>
  </div>

  <script>
    // Datum (de-DE)
    (function(){ try { document.getElementById('today').textContent = new Intl.DateTimeFormat('de-DE').format(new Date()); } catch(_){} })();

    // Tabs
    const tabPerf = document.getElementById('tab-perf');
    const tabNew  = document.getElementById('tab-new');
    const panelPerf = document.getElementById('panel-perf');
    const panelNew  = document.getElementById('panel-new');
    function select(tab){
      const isPerf = tab.id === 'tab-perf';
      tabPerf.setAttribute('aria-selected', isPerf);
      tabNew.setAttribute('aria-selected', !isPerf);
      panelPerf.classList.toggle('hidden', !isPerf);
      panelNew.classList.toggle('hidden', isPerf);
    }
    tabPerf.addEventListener('click', () => select(tabPerf));
    tabNew .addEventListener('click', () => select(tabNew ));

    // SVG-Notfallbild (garantiert sichtbares Thumbnail)
    function setSvg(img, title, reason){
      const svg = encodeURIComponent(
        `<svg xmlns='http://www.w3.org/2000/svg' width='270' height='153'>
           <defs><linearGradient id='g' x1='0' x2='1' y1='0' y2='1'>
             <stop offset='0' stop-color='#1b2a33'/><stop offset='1' stop-color='#0f1720'/>
           </linearGradient></defs>
           <rect width='100%' height='100%' fill='url(#g)'/>
           <text x='16' y='84' font-family='system-ui,Segoe UI,Arial' font-size='20' fill='#e6edf3'>${(title||'Spiel').replace(/&/g,'&amp;')}</text>
           <text x='16' y='120' font-family='system-ui,Segoe UI,Arial' font-size='12' fill='#9aa7b2'>${reason}</text>
         </svg>`
      );
      img.src = `data:image/svg+xml;charset=utf-8,${svg}`;
    }

    // Robuste Bildprüfung: decode() + naturalWidth + onerror
    function ensureThumb(img, title){
      const alt1 = img.getAttribute('data-alt1');
      const tryAlt = () => { if (alt1 && img.src !== alt1) { img.src = alt1; } else { setSvg(img, title, 'Kein Bild verfügbar'); } };
      img.addEventListener('load', () => { if (!img.naturalWidth) tryAlt(); });
      img.addEventListener('error', tryAlt);
      if (img.decode) { img.decode().catch(tryAlt); }
    }

    // PERFORMANCE-PATCHES (inkl. gefixter Problem-Thumbs + bezahlter Upgrades)
    const perf = [
      // --- Auszug (deine bisherigen + fix für die 3 Problemfälle) ---
      {
        name: "Super Mario 3D World + Bowser’s Fury",
        de:   "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/Super-Mario-3D-World-Bowser-s-Fury-1832228.html",
        us:   "https://www.nintendo.com/us/store/products/super-mario-3d-world-bowsers-fury-switch/",
        img:  "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_SuperMario3DWorldBowsersFury_image1600w.jpg",
        img2: "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/s/super-mario-3d-world-bowsers-fury-switch/hero",
        kern: "Visuelle Optimierung, bessere FPS; HDR (nur Bowser’s Fury)"
      },
      {
        name: "DRAGON QUEST III HD-2D Remake",
        de:   "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/DRAGON-QUEST-III-HD-2D-Remake-2639673.html",
        us:   "https://www.nintendo.com/us/store/products/dragon-quest-iii-hd-2d-remake-switch/",
        img:  "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_DragonQuestIIIHD2DRemake_image1600w.jpg",
        img2: "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/d/dragon-quest-iii-hd-2d-remake-switch/hero",
        kern: "Performance-Update: schärfere Grafik + Anzeigemodi"
      },
      {
        name: "The Legend of Zelda: Echoes of Wisdom",
        de:   "https://www.nintendo.com/de-de/Spiele/Nintendo-Switch-Spiele/The-Legend-of-Zelda-Echoes-of-Wisdom-2590490.html",
        us:   "https://www.nintendo.com/us/store/products/the-legend-of-zelda-echoes-of-wisdom-switch/",
        img:  "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_TheLegendOfZeldaEchoesOfWisdom_image1600w.jpg",
        img2: "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/t/the-legend-of-zelda-echoes-of-wisdom-switch/hero",
        kern: "Visuelle Optimierung, HDR (TV)"
      },

      // ... hier alle deine restlichen Einträge wie gehabt ...

      // --- Bezahlte Upgrades (offiziell gelistet) ---
      {
        name: "The Legend of Zelda: Breath of the Wild – Nintendo Switch 2 Edition",
        de:   "https://www.nintendo.com/us/store/products/the-legend-of-zelda-breath-of-the-wild-nintendo-switch-2-edition-switch-2/",
        us:   "https://www.nintendo.com/us/store/products/the-legend-of-zelda-breath-of-the-wild-nintendo-switch-2-edition-upgrade-pack-switch-2/",
        img:  "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_TheLegendOfZeldaBreathOfTheWild_image1600w.jpg",
        img2: "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/t/the-legend-of-zelda-breath-of-the-wild-switch/hero",
        kern: "Upgrade-Pack verfügbar (Leistungs-Boost: Auflösung/FPS, schnellere Ladezeiten; inkl. „Zelda Notes“)."
      },
      {
        name: "The Legend of Zelda: Tears of the Kingdom – Nintendo Switch 2 Edition",
        de:   "https://www.nintendo.com/us/store/products/the-legend-of-zelda-tears-of-the-kingdom-nintendo-switch-2-edition-switch-2/",
        us:   "https://www.nintendo.com/us/store/products/the-legend-of-zelda-tears-of-the-kingdom-nintendo-switch-2-edition-upgrade-pack-switch-2/",
        img:  "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_TheLegendOfZeldaTearsOfTheKingdom_image1600w.jpg",
        img2: "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/t/the-legend-of-zelda-tears-of-the-kingdom-switch/hero",
        kern: "Upgrade-Pack verfügbar; Leistungs-Optimierungen + „Zelda Notes“."
      },
      {
        name: "Kirby und das vergessene Land – Nintendo Switch 2 Edition + Sternensplitter-Welt",
        de:   "https://www.nintendo.com/en-gb/Games/Nintendo-Switch-2-Edition/Kirby-and-the-Forgotten-Land-Nintendo-Switch-2-Edition-Star-Crossed-World-2787773.html",
        us:   "https://www.nintendo.com/us/store/products/kirby-and-the-forgotten-land-nintendo-switch-2-edition-plus-star-crossed-world-upgrade-pack-switch-2/",
        img:  "https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/H2x1_NSwitch_KirbyAndTheForgottenLand_image1600w.jpg",
        img2: "https://assets.nintendo.com/image/upload/f_auto/q_auto/ncom/en_US/games/switch/k/kirby-and-the-forgotten-land-switch/hero",
        kern: "Upgrade-Pack mit neuer Story („Sternensplitter-Welt“) + Performance-Verbesserungen."
      }
    ];

    function rowHtml(e){
      const link = e.de || e.us || '#';
      const label = e.de ? 'Nintendo DE' : (e.us ? 'Nintendo US' : 'Nintendo');
      const title = e.name || 'Unbekannt';
      const kern  = e.kern || '—';
      const src   = e.img  || '';
      const alt   = e.img2 || '';
      return `<tr>
        <td><a href="${link}" target="_blank" rel="noopener">
          <img class="thumb" crossorigin="anonymous" referrerpolicy="no-referrer"
               src="${src}" data-alt1="${alt}" alt="Thumbnail ${title}">
        </a></td>
        <td class="game"><a href="${link}" target="_blank" rel="noopener">${title}</a></td>
        <td class="kernCell">${kern}</td>
        <td class="source"><a href="${link}" target="_blank" rel="noopener">${label}</a></td>
      </tr>`;
    }

    // Render Performance-Liste
    const tbody1 = document.querySelector('#games1 tbody');
    tbody1.innerHTML = perf.map(rowHtml).join('');
    tbody1.querySelectorAll('img.thumb').forEach(img => ensureThumb(img, img.alt.replace('Thumbnail ','') ));
    document.getElementById('count1').textContent = document.querySelectorAll('#games1 tbody tr').length;

    // NEUE SWITCH-2-SPIELE — automatisch aus JSON (ohne Button)
    const newBody = document.querySelector('#games2 tbody');
    const newCount = document.getElementById('newCount');
    async function loadNew(){
      try{
        const r = await fetch('./new_switch2_games.json', {cache:'no-cache'});
        const list = await r.json();
        newBody.innerHTML = list.map(rowHtml).join('');
        newBody.querySelectorAll('img.thumb').forEach(img => ensureThumb(img, img.alt.replace('Thumbnail ','') ));
        newCount.textContent = 'Anzahl: ' + list.length + ' (aus JSON)';
      }catch(e){
        newCount.textContent = 'Konnte new_switch2_games.json nicht laden.';
      }
    }
    loadNew();
  </script>
</body>
</html>
